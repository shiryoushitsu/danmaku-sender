# danmaku-sender

### 简介
弹幕发射场，B站视频歌词弹幕发送工具，上传lrc或ass文件发送普通弹幕或高级弹幕

### 使用说明
【发送普通弹幕歌词】
1.准备好歌曲的lrc歌词

我用得的是网易云歌词提取器，也可以在其他地方获取，或者用lrcmaker直接制作时间轴
网易云歌词提取器：pan.baidu.com/s/1MyqkXp-57B72LoDWFImU3w 提取码: dwda
（暂时只测试了发送单语歌词情况）

2.找到发送弹幕账号的缓存值

打开浏览器下，登录b站后按F12弹出控制台
（chrome浏览器）在Application栏下，找到storage的Cookie，然后找到SESSDATA和bili_jct对应的值）
（火狐浏览器）在存储栏下，找到Cookie，然后找到SESSDATA和bili_jct对应的值）
可将缓存值填写到同目录文件夹下的config.txt文件

3.按需求填入参数

参数简单说明
首句时间：用于调整歌词在视频中出现的时间，直接用歌做视频bgm的可忽略。插件最小时间单位为秒，如需更为准确时间请用补偿值补充调整。有时lrc首句是作词者、或不发声的词，请手动编辑歌词文件去掉。
开始句：发送的歌词从lrc里第几句开始，基本用于测试发送3条弹幕后，继续发送剩下的部分。
**补偿值(ms)**：单位是毫秒，负数提前x毫秒发送，正数延后x毫秒发送，用于首句时间补充。
发送模式：测试发送3条可以用于查看是否基本对准视频中歌词，正式发送弹幕是直接发送全部歌词。
发送间隔：程序发送每条弹幕的时间间隔，最少要填5秒。

按钮简单说明
预览信息：查看将要发送弹幕歌词的相关信息，确认发送视频、时间轴等。
发送弹幕：发送弹幕，之后每5秒获取发送日志信息。
停止发送：发送几条后发现弹幕出现时间搞错后，可点击该按钮停止发送弹幕。
调整发送：发送前3条弹幕，之后设置开始句加3。
剩余发送：将发送模式改为正式发送模式，之后发送弹幕。
个人测试感想补充

0.要测试的话可以去BV1Sa411c7VW测试，暂时是用作发射弹幕场的共用视频。
1.底部弹幕和顶部弹幕存活时间为4s（手机上为7s），有时下载的lrc歌词中两句间隔过短或过长会到造成弹幕堆叠或空缺。
2.下载的lrc歌词和视频中歌曲版本不太一样，导致后续歌词出现时间相差较大。
3.间隔为20秒以下时发送30条后会触发b站发送频率过快，程序设定1分钟后重发，之后每3条就触发一次送频率过快，发送50句左右的单语歌词大概需要20分钟左右。歌词少时可以选择5秒间隔+1分钟重发，歌词多时可以选择20秒间隔。
4.现在自己发歌词弹幕的流程是，找到视频中歌曲第一句发声时间后，修改首句时间，改下颜色，如果声音出的比这秒慢就加500补偿值。预览信息，然后点调整发送（发送前3句），等待发送完成后刷新下视频，如果弹幕时间明显快了或满了就调补偿值，继续调整发送，基本对的上就点剩余发送。单语发送完后，将弹幕模式改为顶部弹幕，修改首句变为1后，发送弹幕。

【发送高级弹幕歌词】
1.准备好歌曲的lrc歌词或ass字幕

高级弹幕歌词需要结束时间，上传lrc歌词时，程序会读取下一句开始时间设定为上句的结束时间，并默认内置两句处理时间为250ms（即提前250ms结束弹幕）。上传ass字幕时，歌词开始时间和结束时间皆为文件内值。
2.找到发送弹幕账号的缓存值

参照发送普通弹幕歌词
3.按需求填入参数

参数简单说明
字体：可手动输入字体，观看者电脑内字体不存在时，使用平台默认字体。
模板：选择对应模板可快速设置高级弹幕淡入、中间、淡出的xy轴位置等参数。保存后会将数据放在同目录下的effectTem.txt文件
起始XY：歌词弹幕位置，值在0到1时为百分比，高于1时为px值。

个人测试感想补充
1.默认淡入、中间、淡出弹幕之间内置50ms重叠，不重叠的话pc端会出现闪烁现象
3.发送40句左右（3段共120句）的单语歌词大概需要1小时左右时间。
4.使用lrc歌词时，因为歌词结束时间为下句的开始时间，有时下载的歌词没有空白行，导致该歌词持续时间会过长，程序设定超过10秒的会变为10秒，或者自行编辑lrc歌词添加空白行。


【发送字符画】
1.上传字符画txt，可直接预览信息。调整发送时间，选择模式，填入参数，预览后再发送。
2.可自定义渐变颜色，在颜色输入框用逗号分开，如果再输入”,1”，则表示颜色循环，例子：ffffff,000000,1。
3.倒序指自带渐变色的颜色倒序。
4。txt文件会判断编码。注意txt文件编码需要是uft-8，否则会乱码。如果预览信息无反应，可以试下将txt另存为utf-8编码，操作为txt-文件-另存为-编码选择为utf8-保存。

【发送Xml文件】
该功能可以将xml格式弹幕发送，主要读取属性有时间、模式、字体、颜色、弹幕池、弹幕内容，其他属性无影响。支持发送16进制颜色代码格式。可用于高自定义M7高级弹幕


### 开发
前端执行命令npm run dev启动
后端springboot启动
网页打开localhost:8080

### 部署
前端执行命令npm run build生成静态文件后
后端再打包
jar包同目录下需要放置config.txt和effectTem.txt文件

